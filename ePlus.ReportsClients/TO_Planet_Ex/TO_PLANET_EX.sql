-- USE EPLUS_DEV10
SET NOCOUNT ON
SET QUOTED_IDENTIFIER OFF

IF OBJECT_ID('DBO.TO_PLANET_EX') IS NULL BEGIN
    EXEC('CREATE PROCEDURE DBO.TO_PLANET_EX AS RETURN')
    GRANT EXEC ON [DBO].[TO_PLANET_EX] TO [PUBLIC]
END
GO
ALTER PROCEDURE DBO.TO_PLANET_EX
    @XMLPARAM NTEXT
AS
DECLARE @STORE VARCHAR(256)
DECLARE @LEN INT
DECLARE @PRICE_BEGIN MONEY
DECLARE @HDOC INT, @SQL NVARCHAR(4000)
DECLARE @DATE_FR DATETIME, @DATE_TO DATETIME
DECLARE @NO_DETAIL BIT, @SORT_DOC BIT, @SHOW_ADD BIT, @SHOW_SUB BIT, @REFRESH_DOC_MOV BIT
DECLARE @SHOW_RETURN BIT
DECLARE @CONTRACTOR TABLE(ID_CONTRACTOR BIGINT NOT NULL, CONTRACTOR_NAME VARCHAR(100))

EXEC SP_XML_PREPAREDOCUMENT @HDOC OUTPUT, @XMLPARAM OUTPUT
    SELECT TOP 1
        @DATE_FR = DATE_FR,
        @DATE_TO = DATE_TO
    FROM OPENXML(@HDOC, '/XML') WITH(
        DATE_FR DATETIME 'DATE_FR',
        DATE_TO DATETIME 'DATE_TO'
    )
    -- КОНТРАГЕНТЫ
	INSERT INTO @CONTRACTOR
    SELECT DISTINCT ID_CONTRACTOR = C.ID_CONTRACTOR, CONTRACTOR_NAME = C.NAME
    FROM CONTRACTOR C
    INNER JOIN (SELECT * FROM OPENXML(@HDOC, '//ID_CONTRACTOR') WITH(ID_CONTRACTOR BIGINT '.')) TAB ON TAB.ID_CONTRACTOR = C.ID_CONTRACTOR

	IF(SELECT COUNT(*) FROM @CONTRACTOR)=0
	BEGIN
		INSERT INTO @CONTRACTOR
		SELECT ID_CONTRACTOR,NAME
		FROM CONTRACTOR	
	END
	
    -- СКЛАДЫ
SELECT S.ID_STORE, S.NAME INTO #STORE FROM STORE S
INNER JOIN @CONTRACTOR C ON C.ID_CONTRACTOR = S.ID_CONTRACTOR
--     SELECT DISTINCT S.ID_STORE, S.ID_CONTRACTOR, S.NAME INTO #STORE
--     FROM STORE S(NOLOCK)
--     INNER JOIN #CONTRACTOR C ON C.ID_CONTRACTOR = S.ID_CONTRACTOR
--     INNER JOIN (SELECT * FROM OPENXML(@HDOC, '//ID_STORE') WITH(ID_STORE BIGINT '.')) TAB ON TAB.ID_STORE = S.ID_STORE
EXEC SP_XML_REMOVEDOCUMENT @HDOC

IF @REFRESH_DOC_MOV = 1 BEGIN
    -- пересчитать DOC_MOVEMENT по всем документам
    EXEC UTL_REFRESH_DOC_MOVEMENT 'REPAIR', 0
END

-- отнормировать даты
EXEC USP_RANGE_NORM @DATE_FR OUT, @DATE_TO OUT
-- print @DATE_FR
-- print @DATE_TO
-- Если не указан склад, то итоги выбираются по всем складам
-- IF NOT EXISTS(SELECT TOP 1 1 FROM #STORE) BEGIN
--     INSERT INTO #STORE (ID_STORE, ID_CONTRACTOR, NAME)
--     SELECT S.ID_STORE, S.ID_CONTRACTOR, S.NAME
--     FROM STORE S(NOLOCK) INNER JOIN #CONTRACTOR C ON C.ID_CONTRACTOR = S.ID_CONTRACTOR
-- END
-- DELETE FROM #STORE WHERE ID_CONTRACTOR NOT IN (SELECT ID_CONTRACTOR FROM #CONTRACTOR)

	-- ОСТАТОК НА НАЧАЛО, СУММЫ (ПРИХОД/РАСХОД)
	SELECT
		SUM_SUP = SUM((DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP),  --сумма по закупочной без НДС
		SUM_SUP_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_SUP_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_SUP_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_ACC_VAT = SUM(CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP),  --сумма по продажной с НДС
		SUM_ACC_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP ELSE 0 END),
		SUM_ACC_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP ELSE 0 END),
		SUM_ACC_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP ELSE 0 END),
		SUM_TORG_NADB = SUM(CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP),
		SUM_TORG_NADB_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_TORG_NADB_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_TORG_NADB_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END)
	FROM DOC_MOVEMENT DM
	INNER JOIN ALL_DOCUMENT AD ON AD.ID_DOCUMENT_GLOBAL = DM.ID_DOCUMENT
	WHERE DATE_OP < @DATE_FR
	AND DM.ID_STORE IN (SELECT ID_STORE FROM #STORE)
	AND DM.ID_TABLE IN (2,3,6,8,12,13,23,19,20,24,30)--,8
--SELECT distinct ID_TABLE FROM DOC_MOVEMENT

--ПРИХОД
	SELECT
        ID_TABLE = DM.ID_TABLE,
		DOC_NUM = AD.DOC_NUM,
		DOC_DATE = AD.DOC_DATE,
		TABLE_NAME = TD.[DESCRIPTION],
-- 		ST = MAX(DM.ID_STORE),
-- 		STORE1 = MAX(AD.ID_STORE1), 
-- 		STORE2 = MAX(AD.ID_STORE2), 
		SUM_SUP_VAT = SUM(DM.SUM_SUP),		--сумма по закупочной с НДС
		SUM_SUP_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SUM_SUP ELSE 0 END),
		SUM_SUP_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SUM_SUP ELSE 0 END),
		SUM_SUP_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SUM_SUP ELSE 0 END),
		SUM_VAT = SUM(DM.SVAT_SUP),			--сумма НДС всего
		SUM_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SVAT_SUP ELSE 0 END),
		SUM_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SVAT_SUP ELSE 0 END),
		SUM_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SVAT_SUP ELSE 0 END),
		SUM_SUP = SUM(DM.SUM_SUP - DM.SVAT_SUP),  			--сумма по закупочной без НДС
		SUM_SUP_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SUM_SUP - DM.SVAT_SUP ELSE 0 END),
		SUM_SUP_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SUM_SUP - DM.SVAT_SUP ELSE 0 END),
		SUM_SUP_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SUM_SUP - DM.SVAT_SUP ELSE 0 END),
		SUM_ACC_VAT = SUM(DM.SUM_ACC),  			--сумма по продажной с НДС
		SUM_ACC_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SUM_ACC ELSE 0 END),
		SUM_ACC_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SUM_ACC ELSE 0 END),
		SUM_ACC_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SUM_ACC ELSE 0 END),
		SUM_TORG_NADB = SUM(DM.SUM_ACC - (DM.SUM_SUP - DM.SVAT_SUP)),      --сумма торг.надбавки
		SUM_TORG_NADB_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SUM_ACC - (DM.SUM_SUP - DM.SVAT_SUP) ELSE 0 END),
		SUM_TORG_NADB_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SUM_ACC - (DM.SUM_SUP - DM.SVAT_SUP) ELSE 0 END),
		SUM_TORG_NADB_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SUM_ACC - (DM.SUM_SUP - DM.SVAT_SUP) ELSE 0 END)
	FROM DOC_MOVEMENT DM
	INNER JOIN ALL_DOCUMENT AD ON AD.ID_DOCUMENT_GLOBAL = DM.ID_DOCUMENT
	INNER JOIN TABLE_DATA TD ON TD.ID_TABLE_DATA = DM.ID_TABLE
--    LEFT JOIN INVOICE I ON I.ID_INVOICE_GLOBAL = DM.ID_DOCUMENT
	WHERE DM.CODE_OP ='ADD' AND DM.ID_TABLE IN (2,6,8,12,13,23,24,30)
		AND DATE_OP BETWEEN @DATE_FR AND @DATE_TO
 		AND DM.ID_STORE IN (SELECT ID_STORE FROM #STORE)
	GROUP BY TD.[DESCRIPTION],DM.ID_TABLE, AD.DOC_NUM, AD.DOC_DATE
	ORDER BY DM.ID_TABLE, AD.DOC_DATE, AD.DOC_NUM 

--РАСХОД

	SELECT
        ID_TABLE = DM.ID_TABLE,
		DOC_NUM = AD.DOC_NUM,
		DOC_DATE = AD.DOC_DATE,
		TABLE_NAME = TD.[DESCRIPTION],
-- 		STORE1 = MAX(AD.ID_STORE1), 
-- 		STORE2 = MAX(AD.ID_STORE2), 
		SUM_SUP_VAT = SUM(DM.SUM_SUP * SIGN_OP * -1),		--сумма по закупочной с НДС
		SUM_SUP_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SUM_SUP* SIGN_OP * -1 ELSE 0 END),
		SUM_SUP_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SUM_SUP* SIGN_OP * -1 ELSE 0 END),
		SUM_SUP_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SUM_SUP* SIGN_OP * -1 ELSE 0 END),
		SUM_VAT = SUM(DM.SVAT_SUP* SIGN_OP * -1),			--сумма НДС всего
		SUM_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN DM.SVAT_SUP* SIGN_OP * -1 ELSE 0 END),
		SUM_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN DM.SVAT_SUP* SIGN_OP * -1 ELSE 0 END),
		SUM_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN DM.SVAT_SUP* SIGN_OP * -1 ELSE 0 END),
		SUM_SUP = SUM((DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP * -1),  			--сумма по закупочной без НДС
		SUM_SUP_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP * -1 ELSE 0 END),
		SUM_SUP_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP * -1 ELSE 0 END),
		SUM_SUP_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP * -1 ELSE 0 END),

 		SUM_ACC_VAT = SUM(CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * SUM_ACC * SIGN_OP * -1),--SUM(DM.SUM_ACC * DM.SIGN_OP * -1),  			--сумма по продажной с НДС
 		SUM_ACC_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * SUM_ACC * SIGN_OP * -1 ELSE 0 END),
 		SUM_ACC_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * SUM_ACC * SIGN_OP * -1 ELSE 0 END),
 		SUM_ACC_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * SUM_ACC * SIGN_OP * -1 ELSE 0 END),
 		SUM_TORG_NADB = SUM(CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * (DM.SUM_ACC * DM.SIGN_OP*-1 - (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP * -1)),--SUM(DM.SUM_ACC * DM.SIGN_OP * -1 - (DM.SUM_SUP - DM.SVAT_SUP)),      --сумма торг.надбавки
 		SUM_TORG_NADB_0 = SUM(CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * CASE WHEN DM.VAT_RATE = 0 THEN DM.SUM_ACC * DM.SIGN_OP*-1 - (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP*-1 ELSE 0 END),
 		SUM_TORG_NADB_10 = SUM(CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * CASE WHEN DM.VAT_RATE = 10 THEN DM.SUM_ACC * DM.SIGN_OP*-1 - (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP*-1 ELSE 0 END),
 		SUM_TORG_NADB_18 = SUM(CASE WHEN CODE_OP='DIS' AND DM.ID_TABLE=19 THEN -1 ELSE 1 END * CASE WHEN DM.VAT_RATE = 18 THEN DM.SUM_ACC * DM.SIGN_OP*-1 - (DM.SUM_SUP - DM.SVAT_SUP)* DM.SIGN_OP*-1 ELSE 0 END)	
	FROM DOC_MOVEMENT DM
	INNER JOIN ALL_DOCUMENT AD ON AD.ID_DOCUMENT_GLOBAL = DM.ID_DOCUMENT
	INNER JOIN TABLE_DATA TD ON TD.ID_TABLE_DATA = DM.ID_TABLE		
	WHERE (CODE_OP IN ('SUB','DIS') OR (DM.ID_TABLE=19 AND CODE_OP='ADD'))
			AND DM.ID_TABLE IN (3,6,8,19,13,20,23,24)
			AND DATE_OP BETWEEN @DATE_FR AND @DATE_TO  
 			AND ((DM.ID_TABLE = 8 AND AD.ID_STORE1 IN (SELECT ID_STORE FROM #STORE))OR (DM.ID_TABLE <> 8 AND DM.ID_STORE IN (SELECT ID_STORE FROM #STORE)))
 -- 			AND DM.ID_STORE IN (SELECT ID_STORE FROM #STORE)
	GROUP BY TD.[DESCRIPTION], DM.ID_TABLE, AD.DOC_NUM, AD.DOC_DATE
    ORDER BY DM.ID_TABLE, AD.DOC_DATE, AD.DOC_NUM

--SELECT * FROM DOC_MOVEMENT WHERE ID_TABLE = 24

--
	SELECT
		SUM_SUP = SUM((DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP),  --сумма по закупочной без НДС
		SUM_SUP_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_SUP_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_SUP_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_ACC_VAT = SUM(CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP),  --сумма по продажной с НДС
		SUM_ACC_VAT0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP ELSE 0 END),
		SUM_ACC_VAT10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP ELSE 0 END),
		SUM_ACC_VAT18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP ELSE 0 END),
		SUM_TORG_NADB = SUM(CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP),
		SUM_TORG_NADB_0 = SUM(CASE WHEN DM.VAT_RATE = 0 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_TORG_NADB_10 = SUM(CASE WHEN DM.VAT_RATE = 10 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END),
		SUM_TORG_NADB_18 = SUM(CASE WHEN DM.VAT_RATE = 18 THEN CASE WHEN DM.ID_TABLE=19 AND CODE_OP='DIS' THEN -1 ELSE 1 END * DM.SUM_ACC * DM.SIGN_OP - (DM.SUM_SUP - DM.SVAT_SUP) * DM.SIGN_OP ELSE 0 END)
	FROM DOC_MOVEMENT DM
	INNER JOIN ALL_DOCUMENT AD ON AD.ID_DOCUMENT_GLOBAL = DM.ID_DOCUMENT
	WHERE DATE_OP <= @DATE_TO
	AND DM.ID_STORE IN (SELECT ID_STORE FROM #STORE)
	AND DM.ID_TABLE IN (2,3,6,8,12,13,19,20,23,24,30)

--SELECT * FROM DOC_MOVEMENT WHERE ID_TABLE = 19

	--ОРГАНИЗАЦИЯ
	SELECT 
		C.ID_CONTRACTOR,
		NAME = C.CONTRACTOR_NAME
	INTO #CONTRACTOR
	FROM @CONTRACTOR C

--	SELECT * FROM #CONTRACTOR

	SELECT	
		S.ID_STORE,
		S.NAME
	INTO #STORES
	FROM @CONTRACTOR C
	INNER JOIN STORE S ON S.ID_CONTRACTOR = C.ID_CONTRACTOR


	DECLARE @STORES VARCHAR(4000), @CONTRACTORS VARCHAR(1024)
	EXEC DBO.USP_TABLE_NAMES '#CONTRACTOR', @CONTRACTORS OUT	
	EXEC DBO.USP_TABLE_NAMES '#STORES', @STORES OUT
	SELECT CONTRACTORS = @CONTRACTORS
	SELECT STORES = @STORES


-- 	SELECT * from CONTRACTOR
-- 	WHERE ID_CONTRACTOR = DBO.FN_CONST_CONTRACTOR_SELF()
RETURN 0
GO

--exec TO_PLANET_EX @xmlParam = N'<XML><DATE_FR>2008-07-21T17:33:16.078</DATE_FR><DATE_TO>2008-07-21T00:00:00.000</DATE_TO><ID_CONTRACTOR>5271</ID_CONTRACTOR></XML>'
--exec TO_PLANET_EX @xmlParam = N'<XML><DATE_FR>2008-12-29T00:00:00.000</DATE_FR><DATE_TO>2009-01-11T00:00:00.000</DATE_TO><ID_CONTRACTOR>5271</ID_CONTRACTOR></XML>'
--exec TO_PLANET_EX @xmlParam = N'<XML><DATE_FR>2008-12-29T00:00:00.000</DATE_FR><DATE_TO>2009-01-11T00:00:00.000</DATE_TO></XML>'
--exec TO_PLANET_EX @xmlParam = N'<XML><DATE_FR>2009-05-18T00:00:00.000</DATE_FR><DATE_TO>2009-05-21T00:00:00.000</DATE_TO><ID_CONTRACTOR>5271</ID_CONTRACTOR><ID_CONTRACTOR>5272</ID_CONTRACTOR></XML>'

